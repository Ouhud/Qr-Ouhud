{% extends "base.html" %}
{% block title %}
  {% if request.state.lang == 'en' %}
    SLA Monitoring
  {% elif request.state.lang == 'ar' %}
    Ù…Ø±Ø§Ù‚Ø¨Ø© SLA
  {% else %}
    SLA Monitoring
  {% endif %}
{% endblock %}
{% block content %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% if lang == 'en' %}
  {% set s_title = 'ğŸ“ˆ SLA & Link Health' %}
  {% set s_done = 'Check run completed. Checked:' %}
  {% set s_uptime = 'Uptime:' %}
  {% set s_latency = 'Avg latency:' %}
  {% set s_check = 'Run check now' %}
  {% set s_recent = 'Latest health checks' %}
  {% set s_time = 'Time' %}
  {% set s_url = 'URL' %}
  {% set s_status = 'Status' %}
  {% set s_latency_col = 'Latency' %}
  {% set s_ok = 'OK' %}
  {% set s_error = 'Error' %}
{% elif lang == 'ar' %}
  {% set s_title = 'ğŸ“ˆ SLA ÙˆØµØ­Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø·' %}
  {% set s_done = 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ÙØ­Øµ. ØªÙ… ÙØ­Øµ:' %}
  {% set s_uptime = 'ÙˆÙ‚Øª Ø§Ù„ØªØ´ØºÙŠÙ„:' %}
  {% set s_latency = 'Ù…ØªÙˆØ³Ø· Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:' %}
  {% set s_check = 'Ø¥Ø¬Ø±Ø§Ø¡ ÙØ­Øµ Ø§Ù„Ø¢Ù†' %}
  {% set s_recent = 'Ø¢Ø®Ø± ÙØ­ÙˆØµØ§Øª Ø§Ù„ØµØ­Ø©' %}
  {% set s_time = 'Ø§Ù„ÙˆÙ‚Øª' %}
  {% set s_url = 'Ø§Ù„Ø±Ø§Ø¨Ø·' %}
  {% set s_status = 'Ø§Ù„Ø­Ø§Ù„Ø©' %}
  {% set s_latency_col = 'Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©' %}
  {% set s_ok = 'Ø³Ù„ÙŠÙ…' %}
  {% set s_error = 'Ø§Ù„Ø®Ø·Ø£' %}
{% else %}
  {% set s_title = 'ğŸ“ˆ SLA & Link Health' %}
  {% set s_done = 'Check-Lauf beendet. GeprÃ¼ft:' %}
  {% set s_uptime = 'Uptime:' %}
  {% set s_latency = 'Ã˜ Latenz:' %}
  {% set s_check = 'Jetzt prÃ¼fen' %}
  {% set s_recent = 'Letzte Health Checks' %}
  {% set s_time = 'Zeit' %}
  {% set s_url = 'URL' %}
  {% set s_status = 'Status' %}
  {% set s_latency_col = 'Latenz' %}
  {% set s_ok = 'OK' %}
  {% set s_error = 'Fehler' %}
{% endif %}
<section class="qr-generator" style="max-width:1100px;">
  <h1>{{ s_title }}</h1>
  {% if checked %}<div class="alert success">{{ s_done }} {{ checked }}</div>{% endif %}

  <div class="qr-form" style="display:flex;gap:1rem;align-items:center;justify-content:space-between;flex-wrap:wrap;">
    <div><strong>{{ s_uptime }}</strong> {{ uptime }}%</div>
    <div><strong>{{ s_latency }}</strong> {{ avg_latency }} ms</div>
    <form method="post" action="/sla/check"><button class="btn-primary" type="submit">{{ s_check }}</button></form>
  </div>

  <div class="qr-form">
    <h2>{{ s_recent }}</h2>
    <div style="overflow:auto;">
      <table style="width:100%;border-collapse:collapse;">
        <thead>
          <tr><th style="text-align:left;">{{ s_time }}</th><th style="text-align:left;">{{ s_url }}</th><th>{{ s_status }}</th><th>{{ s_latency_col }}</th><th>{{ s_ok }}</th><th>{{ s_error }}</th></tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.checked_at }}</td>
            <td style="max-width:340px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">{{ r.target_url }}</td>
            <td>{{ r.status_code or '-' }}</td>
            <td>{{ r.response_time_ms or '-' }} ms</td>
            <td>{{ 'âœ…' if r.ok else 'âŒ' }}</td>
            <td>{{ r.error or '-' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
