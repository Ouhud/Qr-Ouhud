{% extends "base.html" %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% if lang == 'en' %}
  {% set t_title = 'Redeem coupon' %}
  {% set t_offer = 'Offer:' %}
  {% set t_redeem = 'Redemptions:' %}
  {% set t_expiry = 'Expiry:' %}
  {% set t_ok = 'âœ… Coupon redeemed successfully.' %}
  {% set t_err_expired = 'âŒ Coupon has expired.' %}
  {% set t_err_soldout = 'âŒ Maximum redemptions reached.' %}
  {% set t_name = 'Name' %}
  {% set t_email = 'Email' %}
  {% set t_submit = 'Redeem now' %}
{% elif lang == 'ar' %}
  {% set t_title = 'Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø©' %}
  {% set t_offer = 'Ø§Ù„Ø¹Ø±Ø¶:' %}
  {% set t_redeem = 'Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯:' %}
  {% set t_expiry = 'Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:' %}
  {% set t_ok = 'âœ… ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© Ø¨Ù†Ø¬Ø§Ø­.' %}
  {% set t_err_expired = 'âŒ Ø§Ù„Ù‚Ø³ÙŠÙ…Ø© Ù…Ù†ØªÙ‡ÙŠØ©.' %}
  {% set t_err_soldout = 'âŒ ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯.' %}
  {% set t_name = 'Ø§Ù„Ø§Ø³Ù…' %}
  {% set t_email = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' %}
  {% set t_submit = 'Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ø¢Ù†' %}
{% else %}
  {% set t_title = 'Coupon einlÃ¶sen' %}
  {% set t_offer = 'Angebot:' %}
  {% set t_redeem = 'EinlÃ¶sungen:' %}
  {% set t_expiry = 'Ablauf:' %}
  {% set t_ok = 'âœ… Gutschein erfolgreich eingelÃ¶st.' %}
  {% set t_err_expired = 'âŒ Gutschein ist abgelaufen.' %}
  {% set t_err_soldout = 'âŒ Maximale EinlÃ¶sungen erreicht.' %}
  {% set t_name = 'Name' %}
  {% set t_email = 'E-Mail' %}
  {% set t_submit = 'Jetzt einlÃ¶sen' %}
{% endif %}
{% block title %}{{ t_title }}{% endblock %}
{% block content %}
<section class="qr-generator" style="max-width:760px;">
  <h1>ğŸŸï¸ Coupon: {{ data.code }}</h1>
  <p><strong>{{ t_offer }}</strong> {{ data.offer }}</p>
  <p><strong>{{ t_redeem }}</strong> {{ redemptions }}{% if data.max_redemptions %} / {{ data.max_redemptions }}{% endif %}</p>
  {% if data.expires_at %}<p><strong>{{ t_expiry }}</strong> {{ data.expires_at }}</p>{% endif %}

  {% if request.query_params.get("redeemed") == "1" %}
    <div class="alert success">{{ t_ok }}</div>
  {% elif request.query_params.get("error") == "expired" %}
    <div class="alert error">{{ t_err_expired }}</div>
  {% elif request.query_params.get("error") == "soldout" %}
    <div class="alert error">{{ t_err_soldout }}</div>
  {% endif %}

  {% if not expired and not sold_out %}
  <form method="post" action="/qr/coupon/redeem/{{ qr.slug }}" class="qr-form">
    <label>{{ t_name }}</label><input type="text" name="name">
    <label>{{ t_email }}</label><input type="email" name="email">
    <button class="btn-primary" type="submit">{{ t_submit }}</button>
  </form>
  {% endif %}
</section>
{% endblock %}
