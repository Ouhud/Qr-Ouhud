{% extends "base.html" %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% if lang == 'en' %}
  {% set t_mode_edit = 'edit' %}
  {% set t_mode_create = 'create' %}
  {% set t_sub_edit = 'Update your PDF file or title. The QR code stays the same.' %}
  {% set t_sub_create = 'Upload a PDF file and get a <strong>dynamic QR code link</strong>.<br>You can replace the file any time later.' %}
  {% set t_title_label = 'ğŸ“ Title:' %}
  {% set t_file = 'ğŸ“‚ Upload PDF file:' %}
  {% set t_current = 'ğŸ“„ Current file:' %}
  {% set t_save = 'ğŸ’¾ Save changes' %}
  {% set t_create = 'âœ… Create QR code' %}
  {% set t_current_qr = 'ğŸ“ Current QR code' %}
  {% set t_download = 'â¬‡ï¸ Download QR code' %}
  {% set t_success = 'âœ… QR code created successfully!' %}
  {% set t_open_pdf = 'ğŸ“„ Open PDF' %}
  {% set t_preview = 'ğŸ“„ Preview:' %}
  {% set p_title = 'e.g. Product brochure 2025' %}
  {% set page_title = 'ğŸ“„ PDF QR Code ' ~ (t_mode_edit if mode == 'edit' else t_mode_create) ~ ' â€“ Ouhud QR' %}
  {% set h1_title = 'ğŸ“„ PDF QR Code ' ~ (t_mode_edit if mode == 'edit' else t_mode_create) %}
{% elif lang == 'ar' %}
  {% set t_mode_edit = 'ØªØ¹Ø¯ÙŠÙ„' %}
  {% set t_mode_create = 'Ø¥Ù†Ø´Ø§Ø¡' %}
  {% set t_sub_edit = 'Ø­Ø¯Ù‘Ø« Ù…Ù„Ù PDF Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†. ÙŠØ¨Ù‚Ù‰ Ø±Ù…Ø² QR ÙƒÙ…Ø§ Ù‡Ùˆ.' %}
  {% set t_sub_create = 'Ø§Ø±ÙØ¹ Ù…Ù„Ù PDF ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ <strong>Ø±Ø§Ø¨Ø· QR Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ</strong>.<br>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ù„Ù Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.' %}
  {% set t_title_label = 'ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:' %}
  {% set t_file = 'ğŸ“‚ Ø±ÙØ¹ Ù…Ù„Ù PDF:' %}
  {% set t_current = 'ğŸ“„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ:' %}
  {% set t_save = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª' %}
  {% set t_create = 'âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR' %}
  {% set t_current_qr = 'ğŸ“ Ø±Ù…Ø² QR Ø§Ù„Ø­Ø§Ù„ÙŠ' %}
  {% set t_download = 'â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø±Ù…Ø² QR' %}
  {% set t_success = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR Ø¨Ù†Ø¬Ø§Ø­!' %}
  {% set t_open_pdf = 'ğŸ“„ ÙØªØ­ PDF' %}
  {% set t_preview = 'ğŸ“„ Ù…Ø¹Ø§ÙŠÙ†Ø©:' %}
  {% set p_title = 'Ù…Ø«Ø§Ù„: ÙƒØªÙŠØ¨ Ù…Ù†ØªØ¬ 2025' %}
  {% set page_title = 'ğŸ“„ QR Ù„Ù…Ù„Ù PDF ' ~ (t_mode_edit if mode == 'edit' else t_mode_create) ~ ' â€“ Ouhud QR' %}
  {% set h1_title = 'ğŸ“„ QR Ù„Ù…Ù„Ù PDF ' ~ (t_mode_edit if mode == 'edit' else t_mode_create) %}
{% else %}
  {% set t_mode_edit = 'bearbeiten' %}
  {% set t_mode_create = 'erstellen' %}
  {% set t_sub_edit = 'Aktualisiere deine PDF-Datei oder den Titel. Der QR-Code bleibt gleich.' %}
  {% set t_sub_create = 'Lade eine PDF-Datei hoch und erhalte einen <strong>dynamischen QR-Code-Link</strong>.<br>Du kannst die Datei spÃ¤ter jederzeit austauschen.' %}
  {% set t_title_label = 'ğŸ“ Titel:' %}
  {% set t_file = 'ğŸ“‚ PDF-Datei hochladen:' %}
  {% set t_current = 'ğŸ“„ Aktuelle Datei:' %}
  {% set t_save = 'ğŸ’¾ Ã„nderungen speichern' %}
  {% set t_create = 'âœ… QR-Code erstellen' %}
  {% set t_current_qr = 'ğŸ“ Aktueller QR-Code' %}
  {% set t_download = 'â¬‡ï¸ QR-Code herunterladen' %}
  {% set t_success = 'âœ… QR-Code erfolgreich erstellt!' %}
  {% set t_open_pdf = 'ğŸ“„ PDF Ã¶ffnen' %}
  {% set t_preview = 'ğŸ“„ Vorschau:' %}
  {% set p_title = 'z. B. ProduktbroschÃ¼re 2025' %}
  {% set page_title = 'ğŸ“„ PDF-QR-Code ' ~ (t_mode_edit if mode == 'edit' else t_mode_create) ~ ' â€“ Ouhud QR' %}
  {% set h1_title = 'ğŸ“„ PDF-QR-Code ' ~ (t_mode_edit if mode == 'edit' else t_mode_create) %}
{% endif %}
{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<section class="qr-generator pdf-generator">
  <h1>{{ h1_title }}</h1>
  <p class="subtitle">
    {% if mode == "edit" %}
      {{ t_sub_edit }}
    {% else %}
      {{ t_sub_create|safe }}
    {% endif %}
  </p>

  <form method="post" action="{% if mode == 'edit' %}/qr/pdf/update/{{ qr.id }}{% else %}/qr/pdf/generate{% endif %}" enctype="multipart/form-data" class="qr-form">
    <div class="form-group">
      <label for="title">{{ t_title_label }}</label>
      <input type="text" id="title" name="title" value="{{ qr.title if qr else '' }}" placeholder="{{ p_title }}" required>
    </div>

    <div class="form-group">
      <label for="file">{{ t_file }}</label>
      <input type="file" id="file" name="file" accept="application/pdf" {% if mode != "edit" %}required{% endif %} onchange="previewPdf(event)">
      {% if mode == "edit" and qr_data.pdf_path %}
        <p class="current-file">{{ t_current }} {{ qr_data.pdf_path.split('/')[-1] }}</p>
      {% endif %}
    </div>

    <hr class="divider">

    {% set submit_label = t_save if mode == "edit" else t_create %}
    {% include "partials/qr_style_selector.html" %}
  </form>

  {% if mode == "edit" and qr %}
  <div class="qr-result">
    <p><strong>{{ t_current_qr }}</strong></p>
    <img src="/{{ qr.image_path }}" alt="QR-Code" class="qr-preview">
    <p>
      <a href="/{{ qr.image_path }}" download class="download-link">{{ t_download }}</a>
    </p>
  </div>
  {% endif %}

  {% if qr_image %}
  <div class="qr-result">
    <p><strong>{{ t_success }}</strong></p>
    <img src="data:image/png;base64,{{ qr_image }}" alt="QR-Code Vorschau" class="qr-preview">
    <p>
      <a href="{{ dynamic_url }}" target="_blank" class="download-link">{{ t_open_pdf }}</a><br>
      <a href="data:image/png;base64,{{ qr_image }}" download="qr_pdf.png" class="download-link">{{ t_download }}</a>
    </p>
  </div>
  {% endif %}
</section>

<script>
const PDF_PREVIEW_LABEL = {{ t_preview | tojson }};
function previewPdf(event) {
  const file = event.target.files[0];
  if (file && file.type === "application/pdf") {
    const container = document.getElementById("pdf-preview-container") || document.createElement("div");
    container.id = "pdf-preview-container";
    container.classList.add("pdf-preview-container");

    const preview = document.createElement("embed");
    preview.src = URL.createObjectURL(file);
    preview.type = "application/pdf";
    preview.classList.add("pdf-preview");

    container.innerHTML = `<p class="preview-label">${PDF_PREVIEW_LABEL}</p>`;
    container.appendChild(preview);

    document.querySelector(".qr-form").insertAdjacentElement("afterend", container);
  }
}
</script>

<style>
.current-file {
  font-size: 0.9rem;
  color: #0D2A78;
  margin-top: 0.5rem;
}
</style>
{% endblock %}
