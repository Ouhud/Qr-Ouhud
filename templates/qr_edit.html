{% extends "base.html" %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% macro tr(de, en, ar) -%}
  {%- if lang == 'en' -%}{{ en }}
  {%- elif lang == 'ar' -%}{{ ar }}
  {%- else -%}{{ de }}
  {%- endif -%}
{%- endmacro %}
{% block title %}âœï¸ {{ tr('QR-Code bearbeiten', 'Edit QR Code', 'ØªØ¹Ø¯ÙŠÙ„ Ø±Ù…Ø² QR') }} â€“ Ouhud QR{% endblock %}

{% block content %}
<section class="qr-editor">
  <h1>âœï¸ {{ tr('QR-Code bearbeiten', 'Edit QR Code', 'ØªØ¹Ø¯ÙŠÙ„ Ø±Ù…Ø² QR') }}</h1>
  <p class="subtitle">{{ tr('Der QR-Code bleibt gleich â€“ du Ã¤nderst nur Inhalt oder Design.', 'The QR code stays the same - you only update content or design.', 'ÙŠØ¨Ù‚Ù‰ Ø±Ù…Ø² QR ÙƒÙ…Ø§ Ù‡Ùˆ - ÙŠÙ…ÙƒÙ†Ùƒ ÙÙ‚Ø· ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø§Ù„ØªØµÙ…ÙŠÙ….') }}</p>

  {% if request.query_params.get("msg") == "ok" %}
    <div class="alert success">âœ… {{ tr('Ã„nderungen erfolgreich gespeichert!', 'Changes saved successfully!', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!') }}</div>
  {% endif %}

  <form method="post" action="/qr/update/{{ qr.slug }}" enctype="multipart/form-data" class="qr-form">
    
    <!-- ğŸ§¾ Allgemeine Infos -->
    <div class="section">
      <label for="title">ğŸ“ {{ tr('Bezeichnung', 'Title', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†') }}</label>
      <input type="text" id="title" name="title" value="{{ qr.title or '' }}" required>
    </div>

    <!-- ğŸ”— Dynamische Eingabefelder nach Typ -->
    {% if qr.type == 'url' %}
      <div class="section">
        <h3>ğŸŒ {{ tr('Ziel-URL', 'Target URL', 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù‡Ø¯Ù') }}</h3>
        <input type="url" id="url" name="url" value="{{ data.url or '' }}" placeholder="https://example.com" required>
        <h4 style="margin-top:1rem;">{{ tr('UTM-Tracking', 'UTM Tracking', 'ØªØªØ¨Ø¹ UTM') }}</h4>
        <input type="text" name="utm_source" value="{{ (data.utm or {}).source or '' }}" placeholder="utm_source">
        <input type="text" name="utm_medium" value="{{ (data.utm or {}).medium or '' }}" placeholder="utm_medium">
        <input type="text" name="utm_campaign" value="{{ (data.utm or {}).campaign or '' }}" placeholder="utm_campaign">
        <input type="text" name="utm_term" value="{{ (data.utm or {}).term or '' }}" placeholder="utm_term">
        <input type="text" name="utm_content" value="{{ (data.utm or {}).content or '' }}" placeholder="utm_content">
        <h4 style="margin-top:1rem;">{{ tr('A/B-Ziel-URLs (JSON)', 'A/B Target URLs (JSON)', 'Ø±ÙˆØ§Ø¨Ø· A/B Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© (JSON)') }}</h4>
        <textarea name="ab_targets_json" rows="4" placeholder='[{"url":"https://a.example","weight":50},{"url":"https://b.example","weight":50}]'>{{ data.ab_targets | tojson if data.ab_targets else '' }}</textarea>
        <h4 style="margin-top:1rem;">{{ tr('Regeln Zeit/Land/Sprache/Geraet (JSON)', 'Rules by Time/Country/Language/Device (JSON)', 'Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙˆÙ‚Øª/Ø§Ù„Ø¯ÙˆÙ„Ø©/Ø§Ù„Ù„ØºØ©/Ø§Ù„Ø¬Ù‡Ø§Ø² (JSON)') }}</h4>
        <textarea name="rules_json" rows="5" placeholder='[{"target_url":"https://de.example","countries":["DE"],"languages":["de"],"devices":["desktop"],"time_from":"08:00","time_to":"18:00"}]'>{{ data.rules | tojson if data.rules else '' }}</textarea>
      </div>

    {% elif qr.type == 'wifi' %}
      <div class="section">
        <h3>ğŸ“¶ {{ tr('WLAN-Zugangsdaten', 'Wi-Fi Access Data', 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§ØªØµØ§Ù„ Wi-Fi') }}</h3>
        <input type="text" id="ssid" name="ssid" value="{{ data.ssid or '' }}" placeholder="SSID">
        <input type="text" id="password" name="password" value="{{ data.password or '' }}" placeholder="{{ tr('Passwort', 'Password', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±') }}">
        <select name="encryption" class="w-full border rounded-md px-3 py-2 mt-2">
          <option value="WPA" {% if data.encryption == 'WPA' %}selected{% endif %}>WPA/WPA2</option>
          <option value="WEP" {% if data.encryption == 'WEP' %}selected{% endif %}>WEP</option>
          <option value="nopass" {% if data.encryption == 'nopass' %}selected{% endif %}>{{ tr('Keine VerschlÃ¼sselung', 'No encryption', 'Ø¨Ø¯ÙˆÙ† ØªØ´ÙÙŠØ±') }}</option>
        </select>
      </div>

    {% elif qr.type == 'email' %}
      <div class="section">
        <h3>ğŸ“§ {{ tr('E-Mail QR', 'Email QR', 'Ø±Ù…Ø² QR Ù„Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ') }}</h3>
        <input type="email" id="email" name="email" value="{{ data.to or '' }}" placeholder="{{ tr('E-Mail-Adresse', 'Email address', 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ') }}">
        <input type="text" id="subject" name="subject" value="{{ data.subject or '' }}" placeholder="{{ tr('Betreff', 'Subject', 'Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹') }}">
        <textarea id="body" name="body" rows="3" placeholder="{{ tr('Nachrichtentext', 'Message', 'Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©') }}">{{ data.body or '' }}</textarea>
      </div>

    {% elif qr.type == 'sms' %}
      <div class="section">
        <h3>ğŸ’¬ {{ tr('SMS QR', 'SMS QR', 'Ø±Ù…Ø² QR Ù„Ù„Ø±Ø³Ø§Ø¦Ù„') }}</h3>
        <input type="text" id="phone" name="phone" value="{{ data.phone or '' }}" placeholder="{{ tr('Telefonnummer', 'Phone number', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ') }}">
        <textarea id="message" name="message" rows="3" placeholder="{{ tr('Nachrichtentext', 'Message', 'Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©') }}">{{ data.message or '' }}</textarea>
      </div>

    {% elif qr.type == 'tel' %}
      <div class="section">
        <h3>ğŸ“ {{ tr('Telefon QR', 'Phone QR', 'Ø±Ù…Ø² QR Ù„Ù„Ù‡Ø§ØªÙ') }}</h3>
        <input type="text" id="phone" name="phone" value="{{ data.phone or '' }}" placeholder="{{ tr('Telefonnummer', 'Phone number', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ') }}">
      </div>

    {% elif qr.type == 'social' %}
      <div class="section">
        <h3>ğŸ“± {{ tr('Social Link Seite', 'Social Link Page', 'ØµÙØ­Ø© Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„') }}</h3>
        <input type="text" id="social_name" name="name" value="{{ data.name or '' }}" placeholder="{{ tr('Name oder Profil-Titel', 'Name or profile title', 'Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ') }}">
        <input type="text" id="social_title" name="title" value="{{ data.title or '' }}" placeholder="{{ tr('Interner Titel (optional)', 'Internal title (optional)', 'Ø¹Ù†ÙˆØ§Ù† Ø¯Ø§Ø®Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)') }}">
        <input type="url" id="website" name="website" value="{{ data.website or '' }}" placeholder="{{ tr('Website', 'Website', 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ') }}">
        <input type="url" id="facebook" name="facebook" value="{{ data.facebook or '' }}" placeholder="{{ tr('Facebook-Link', 'Facebook link', 'Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ') }}">
        <input type="url" id="instagram" name="instagram" value="{{ data.instagram or '' }}" placeholder="{{ tr('Instagram-Link', 'Instagram link', 'Ø±Ø§Ø¨Ø· Ø¥Ù†Ø³ØªØºØ±Ø§Ù…') }}">
        <input type="url" id="whatsapp" name="whatsapp" value="{{ data.whatsapp or '' }}" placeholder="{{ tr('WhatsApp-Link', 'WhatsApp link', 'Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨') }}">
        <input type="url" id="linkedin" name="linkedin" value="{{ data.linkedin or '' }}" placeholder="{{ tr('LinkedIn-Profil', 'LinkedIn profile', 'Ù…Ù„Ù LinkedIn') }}">
        <input type="url" id="xing" name="xing" value="{{ data.xing or '' }}" placeholder="{{ tr('Xing-Profil', 'Xing profile', 'Ù…Ù„Ù Xing') }}">
        <input type="url" id="github" name="github" value="{{ data.github or '' }}" placeholder="{{ tr('GitHub-Profil', 'GitHub profile', 'Ù…Ù„Ù GitHub') }}">
        <input type="url" id="tiktok" name="tiktok" value="{{ data.tiktok or '' }}" placeholder="{{ tr('TikTok-Link', 'TikTok link', 'Ø±Ø§Ø¨Ø· TikTok') }}">
        <input type="url" id="twitter" name="twitter" value="{{ data.twitter or '' }}" placeholder="{{ tr('X / Twitter-Link', 'X / Twitter link', 'Ø±Ø§Ø¨Ø· X / Twitter') }}">
      </div>

    {% elif qr.type == 'geo' %}
      <div class="section">
        <h3>ğŸ—ºï¸ {{ tr('Standort QR', 'Location QR', 'Ø±Ù…Ø² QR Ù„Ù„Ù…ÙˆÙ‚Ø¹') }}</h3>
        <input type="text" id="lat" name="lat" value="{{ data.lat or '' }}" placeholder="{{ tr('Breitengrad', 'Latitude', 'Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶') }}">
        <input type="text" id="lon" name="lon" value="{{ data.lon or '' }}" placeholder="{{ tr('Laengengrad', 'Longitude', 'Ø®Ø· Ø§Ù„Ø·ÙˆÙ„') }}">
      </div>

    {% elif qr.type == 'event' %}
      <div class="section">
        <h3>ğŸ—“ï¸ {{ tr('Event QR', 'Event QR', 'Ø±Ù…Ø² QR Ù„Ù„ÙØ¹Ø§Ù„ÙŠØ©') }}</h3>
        <input type="text" id="summary" name="summary" value="{{ data.summary or '' }}" placeholder="{{ tr('Titel', 'Title', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†') }}">
        <input type="text" id="dtstart" name="dtstart" value="{{ data.dtstart or '' }}" placeholder="{{ tr('Startzeit', 'Start time', 'ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡') }}">
        <input type="text" id="dtend" name="dtend" value="{{ data.dtend or '' }}" placeholder="{{ tr('Endzeit', 'End time', 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡') }}">
        <input type="text" id="location" name="location" value="{{ data.location or '' }}" placeholder="{{ tr('Ort', 'Location', 'Ø§Ù„Ù…ÙˆÙ‚Ø¹') }}">
        <textarea id="description" name="description" rows="3" placeholder="{{ tr('Beschreibung', 'Description', 'Ø§Ù„ÙˆØµÙ') }}">{{ data.description or '' }}</textarea>
      </div>

    {% elif qr.type == 'payment' %}
      <div class="section">
        <h3>ğŸ’³ {{ tr('Payment QR', 'Payment QR', 'Ø±Ù…Ø² QR Ù„Ù„Ø¯ÙØ¹') }}</h3>
        <input type="url" id="payment_url" name="payment_url" value="{{ data.payment_url or '' }}" placeholder="https://...">
      </div>

    {% elif qr.type == 'product' %}
      <div class="section">
        <h3>ğŸ·ï¸ {{ tr('Produkt QR', 'Product QR', 'Ø±Ù…Ø² QR Ù„Ù„Ù…Ù†ØªØ¬') }}</h3>
        <input type="text" id="name" name="name" value="{{ data.name or '' }}" placeholder="{{ tr('Produktname', 'Product name', 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬') }}">
        <input type="text" id="price" name="price" value="{{ data.price or '' }}" placeholder="{{ tr('Preis', 'Price', 'Ø§Ù„Ø³Ø¹Ø±') }}">
        <input type="url" id="product_url" name="product_url" value="{{ data.product_url or '' }}" placeholder="https://...">
      </div>

    {% elif qr.type == 'multilink' %}
      <div class="section">
        <h3>ğŸ”— {{ tr('Multi-Link QR', 'Multi-Link QR', 'Ø±Ù…Ø² QR Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·') }}</h3>
        <textarea id="public_html" name="public_html" rows="6" placeholder="{{ tr('HTML-Inhalt', 'HTML content', 'Ù…Ø­ØªÙˆÙ‰ HTML') }}">{{ data.public_html or '' }}</textarea>
      </div>

    {% elif qr.type == 'wallet' %}
      <div class="section">
        <h3>ğŸ« {{ tr('Wallet Pass QR', 'Wallet Pass QR', 'Ø±Ù…Ø² QR Ù„Ù…Ø­ÙØ¸Ø© Wallet') }}</h3>
        <input type="text" name="wallet_type" value="{{ data.wallet_type or '' }}" placeholder="{{ tr('Typ (ticket/loyalty/coupon)', 'Type (ticket/loyalty/coupon)', 'Ø§Ù„Ù†ÙˆØ¹ (ticket/loyalty/coupon)') }}">
        <input type="url" name="apple_pass_url" value="{{ data.apple_pass_url or '' }}" placeholder="Apple Wallet URL">
        <input type="url" name="google_pass_url" value="{{ data.google_pass_url or '' }}" placeholder="Google Wallet URL">
        <input type="url" name="pass_url" value="{{ data.pass_url or '' }}" placeholder="{{ tr('Fallback URL', 'Fallback URL', 'Ø±Ø§Ø¨Ø· Ø¨Ø¯ÙŠÙ„') }}">
      </div>

    {% elif qr.type == 'gs1' %}
      <div class="section">
        <h3>ğŸ·ï¸ GS1 Digital Link</h3>
        <input type="url" name="gs1_link" value="{{ data.gs1_link or '' }}" placeholder="https://.../01/GTIN/...">
      </div>

    {% elif qr.type == 'app_deeplink' %}
      <div class="section">
        <h3>ğŸ“² {{ tr('App Deep Link', 'App Deep Link', 'Ø±Ø§Ø¨Ø· Ø¹Ù…ÙŠÙ‚ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚') }}</h3>
        <input type="url" name="deep_link" value="{{ data.deep_link or '' }}" placeholder="myapp://...">
        <input type="url" name="ios_store_url" value="{{ data.ios_store_url or '' }}" placeholder="iOS Store URL">
        <input type="url" name="android_store_url" value="{{ data.android_store_url or '' }}" placeholder="Android Store URL">
        <input type="url" name="web_fallback_url" value="{{ data.web_fallback_url or '' }}" placeholder="{{ tr('Web Fallback URL', 'Web fallback URL', 'Ø±Ø§Ø¨Ø· Ø¨Ø¯ÙŠÙ„ Ù„Ù„ÙˆÙŠØ¨') }}">
      </div>

    {% elif qr.type == 'review' %}
      <div class="section">
        <h3>â­ {{ tr('Bewertungs-QR', 'Review QR', 'Ø±Ù…Ø² QR Ù„Ù„ØªÙ‚ÙŠÙŠÙ…') }}</h3>
        <input type="url" name="review_url" value="{{ data.review_url or '' }}" placeholder="Review URL">
      </div>

    {% elif qr.type == 'booking' %}
      <div class="section">
        <h3>ğŸ“… {{ tr('Terminbuchung-QR', 'Booking QR', 'Ø±Ù…Ø² QR Ù„Ù„Ø­Ø¬Ø²') }}</h3>
        <input type="url" name="booking_url" value="{{ data.booking_url or '' }}" placeholder="Booking URL">
      </div>

    {% elif qr.type == 'lead' %}
      <div class="section">
        <h3>ğŸ§¾ {{ tr('Lead-Formular-QR', 'Lead Form QR', 'Ø±Ù…Ø² QR Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡') }}</h3>
        <input type="text" name="headline" value="{{ data.headline or '' }}" placeholder="{{ tr('Ãœberschrift', 'Headline', 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ') }}">
        <textarea name="description" rows="3" placeholder="{{ tr('Beschreibung', 'Description', 'Ø§Ù„ÙˆØµÙ') }}">{{ data.description or '' }}</textarea>
        <input type="text" name="success_message" value="{{ data.success_message or '' }}" placeholder="{{ tr('Erfolgsmeldung', 'Success message', 'Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­') }}">
      </div>

    {% elif qr.type == 'feedback' %}
      <div class="section">
        <h3>ğŸ“Š {{ tr('Feedback/NPS-QR', 'Feedback/NPS QR', 'Ø±Ù…Ø² QR Ù„Ù„ØªÙ‚ÙŠÙŠÙ…/NPS') }}</h3>
        <input type="text" name="question" value="{{ data.question or '' }}" placeholder="{{ tr('Frage', 'Question', 'Ø§Ù„Ø³Ø¤Ø§Ù„') }}">
        <input type="text" name="low_label" value="{{ data.low_label or '' }}" placeholder="{{ tr('Label niedrig', 'Low label', 'ØªØ³Ù…ÙŠØ© Ù…Ù†Ø®ÙØ¶') }}">
        <input type="text" name="high_label" value="{{ data.high_label or '' }}" placeholder="{{ tr('Label hoch', 'High label', 'ØªØ³Ù…ÙŠØ© Ù…Ø±ØªÙØ¹') }}">
      </div>

    {% elif qr.type == 'coupon' %}
      <div class="section">
        <h3>ğŸŸï¸ {{ tr('Gutschein-QR', 'Coupon QR', 'Ø±Ù…Ø² QR Ù„Ù„Ù‚Ø³ÙŠÙ…Ø©') }}</h3>
        <input type="text" name="code" value="{{ data.code or '' }}" placeholder="{{ tr('Code', 'Code', 'Ø§Ù„Ø±Ù…Ø²') }}">
        <input type="text" name="offer" value="{{ data.offer or '' }}" placeholder="{{ tr('Angebot', 'Offer', 'Ø§Ù„Ø¹Ø±Ø¶') }}">
        <input type="datetime-local" name="expires_at" value="{{ data.expires_at or '' }}">
        <input type="number" name="max_redemptions" value="{{ data.max_redemptions or 0 }}" placeholder="{{ tr('Max. EinlÃ¶sungen', 'Max redemptions', 'Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…') }}">
      </div>

    {% elif qr.type == 'vcard' %}
      <div class="section">
        <h3>ğŸ‘¤ {{ tr('vCard Informationen', 'vCard Information', 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª vCard') }}</h3>
        <input type="text" id="first_name" name="first_name" value="{{ data.first_name or '' }}" placeholder="{{ tr('Vorname', 'First name', 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„') }}">
        <input type="text" id="last_name" name="last_name" value="{{ data.last_name or '' }}" placeholder="{{ tr('Nachname', 'Last name', 'Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©') }}">
        <input type="text" id="phone" name="phone" value="{{ data.phone or '' }}" placeholder="{{ tr('Telefonnummer', 'Phone number', 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ') }}">
        <input type="email" id="email" name="email" value="{{ data.email or '' }}" placeholder="{{ tr('E-Mail', 'Email', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ') }}">
        <input type="text" id="org" name="org" value="{{ data.org or '' }}" placeholder="{{ tr('Firma', 'Company', 'Ø§Ù„Ø´Ø±ÙƒØ©') }}">
        <input type="url" id="website" name="website" value="{{ data.website or '' }}" placeholder="{{ tr('Website', 'Website', 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ') }}">
        <input type="url" id="apple_wallet_url" name="apple_wallet_url" value="{{ data.apple_wallet_url or '' }}" placeholder="Apple Wallet Pass URL">
        <input type="url" id="google_wallet_url" name="google_wallet_url" value="{{ data.google_wallet_url or '' }}" placeholder="Google Wallet Pass URL">
      </div>

    {% else %}
      <div class="section">
        <h3>ğŸ§¾ {{ tr('Inhalt', 'Content', 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰') }}</h3>
        <textarea id="field1" name="field1" rows="3">{{ data.content or '' }}</textarea>
      </div>
    {% endif %}

    <hr class="divider">

    <!-- ğŸ¨ Stil-Auswahl -->
    <h3>ğŸ¨ {{ tr('Design & Stil', 'Design & Style', 'Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ù†Ù…Ø·') }}</h3>
    {% set include_submit = false %}
    {% set include_print = false %}
    {% set default_style = qr.style or "classic" %}
    {% include "partials/qr_style_selector.html" %}

    <!-- ğŸ¨ Farbwahl, Logo, GrÃ¶ÃŸe -->
    <div class="design-grid">
      <div>
        <label for="fg_color">{{ tr('Vordergrundfarbe:', 'Foreground color:', 'Ù„ÙˆÙ† Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©:') }}</label>
        <input type="color" id="fg_color" name="color_fg" value="{{ qr.color_fg or '#000000' }}">
      </div>
      <div>
        <label for="bg_color">{{ tr('Hintergrundfarbe:', 'Background color:', 'Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©:') }}</label>
        <input type="color" id="bg_color" name="color_bg" value="{{ qr.color_bg or '#FFFFFF' }}">
      </div>
      <div>
        <label for="qr_size">ğŸ“ {{ tr('GrÃ¶ÃŸe:', 'Size:', 'Ø§Ù„Ø­Ø¬Ù…:') }}</label>
        <input type="range" id="qr_size" name="qr_size" min="200" max="1000"
               value="{{ qr.qr_size or 400 }}"
               oninput="qrSizeValue.textContent=this.value + ' px'">
        <output id="qrSizeValue">{{ qr.qr_size or 400 }} px</output>
      </div>
      <div>
        <label for="logo">ğŸ·ï¸ {{ tr('Logo (optional):', 'Logo (optional):', 'Ø§Ù„Ø´Ø¹Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):') }}</label>
        <input type="file" id="logo" name="logo" accept="image/*" onchange="previewLogo(event)">
        <div id="logo-preview-container" {% if not qr.logo_path %}style="display:none;"{% endif %}>
          <p>{{ tr('Aktuelles Logo:', 'Current logo:', 'Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:') }}</p>
          {% if qr.logo_path %}
            {% set logo_src = qr.logo_path if qr.logo_path.startswith('/') else '/' + qr.logo_path %}
            <img id="logo-preview" src="{{ logo_src }}" alt="{{ tr('Logo-Vorschau', 'Logo preview', 'Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±') }}">
          {% else %}
            <img id="logo-preview" src="https://via.placeholder.com/150?text=Logo" alt="{{ tr('Logo-Vorschau', 'Logo preview', 'Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ø¹Ø§Ø±') }}">
          {% endif %}
        </div>
      </div>
    </div>

    <button type="submit" class="btn full">ğŸ’¾ {{ tr('Ã„nderungen speichern', 'Save changes', 'Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª') }}</button>
    <a href="/d/{{ qr.slug }}" class="btn secondary" target="_blank" rel="noopener">ğŸ‘ï¸ {{ tr('Vorschau', 'Preview', 'Ù…Ø¹Ø§ÙŠÙ†Ø©') }}</a>
  </form>

  <!-- ğŸ“¸ QR-Code Vorschau -->
  <div class="qr-result">
    <h3>ğŸ“ {{ tr('Aktueller QR-Code', 'Current QR Code', 'Ø±Ù…Ø² QR Ø§Ù„Ø­Ø§Ù„ÙŠ') }}</h3>

    {% if qr_image %}
      <img src="{{ qr_image }}" alt="{{ tr('QR-Code', 'QR code', 'Ø±Ù…Ø² QR') }}" width="250" class="qr-preview">
    {% elif qr and qr.image_path %}
      <img src="/{{ qr.image_path }}" alt="{{ tr('QR-Code', 'QR code', 'Ø±Ù…Ø² QR') }}" width="250" class="qr-preview">
    {% else %}
      <img src="/static/default-qr.png" alt="{{ tr('QR-Code', 'QR code', 'Ø±Ù…Ø² QR') }}" width="250" class="qr-preview">
    {% endif %}

    <div style="margin-top:1rem;">
      {% if qr and qr.image_path %}
        <a href="/{{ qr.image_path }}" download class="btn primary">â¬‡ï¸ {{ tr('Herunterladen', 'Download', 'ØªÙ†Ø²ÙŠÙ„') }}</a>
      {% endif %}
      <button onclick="window.print()" class="btn secondary">ğŸ–¨ï¸ {{ tr('Drucken', 'Print', 'Ø·Ø¨Ø§Ø¹Ø©') }}</button>
    </div>
  </div>
</section>

<!-- ğŸ§¾ STYLES -->
<style>
.qr-editor{max-width:900px;margin:3rem auto;padding:2.5rem;background:#fff;border-radius:20px;
box-shadow:0 8px 30px rgba(13,42,120,0.08);font-family:"Inter",system-ui,sans-serif;}
h1{text-align:center;color:#0d2a78;margin-bottom:.5rem;}
.subtitle{text-align:center;color:#475569;margin-bottom:2rem;}
.alert.success{background:#dcfce7;color:#15803d;padding:.8rem 1rem;border-radius:8px;margin-bottom:1rem;text-align:center;}
label{font-weight:600;color:#0d2a78;display:block;margin-bottom:.4rem;}
input,textarea,select{width:100%;padding:.7rem;border:1px solid #cbd5e1;border-radius:10px;
font-size:1rem;background:#f9fafb;transition:.2s ease;}
input:focus,textarea:focus,select:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.2);}
.design-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;background:#f8f9fa;
border-radius:12px;padding:1rem;margin-top:1rem;}
.btn{display:inline-block;background:linear-gradient(135deg,#0d2a78,#2563eb);color:white;border:none;border-radius:10px;
padding:.8rem 1.6rem;font-weight:600;text-decoration:none;cursor:pointer;margin-top:1rem;transition:.2s ease-in-out;}
.btn:hover{transform:translateY(-2px);background:linear-gradient(135deg,#0b2163,#1e3a8a);}
.btn.secondary{background:#2563eb;}
.btn.full{display:block;width:100%;text-align:center;}
.qr-result{margin-top:2rem;background:#f3f6ff;border-radius:16px;padding:1.5rem;text-align:center;
box-shadow:0 4px 12px rgba(0,0,0,.05);}
.qr-preview{max-width:250px;margin-top:1rem;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);}
html[lang="ar"] .qr-editor{text-align:right;}
@media(max-width:600px){.qr-editor{padding:1.5rem;}.design-grid{grid-template-columns:1fr;}}
</style>

<!-- ğŸ§¾ SCRIPTS -->
<script>
function previewLogo(event){
  const container=document.getElementById('logo-preview-container');
  const img=document.getElementById('logo-preview');
  const file=event.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=e=>{
      img.src=e.target.result;
      container.style.display='block';
    };
    reader.readAsDataURL(file);
  }
}
</script>
{% endblock %}
