{% extends "base.html" %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% if lang == 'en' %}
  {% set s_title = 'ğŸ”’ Security â€“ Ouhud QR' %}
  {% set s_h1 = 'ğŸ”’ Security' %}
  {% set s_sub = 'Manage password, 2FA, login devices, API keys, and account deletion.' %}
  {% set s_pw = 'Change password' %}
  {% set s_old = 'Current password' %}
  {% set s_new = 'New password' %}
  {% set s_new2 = 'Confirm new password' %}
  {% set s_save = 'ğŸ’¾ Save password' %}
  {% set s_2fa = 'Two-factor authentication (2FA)' %}
  {% set s_2fa_sub = 'Add an extra security layer using an authenticator app.' %}
  {% set s_status = 'Status:' %}
  {% set s_active = 'Active' %}
  {% set s_inactive = 'Not active' %}
  {% set s_pwd_confirm = 'Password confirmation' %}
  {% set s_code = 'Current 2FA code' %}
  {% set s_disable_2fa = 'Disable 2FA' %}
  {% set s_step1 = '1. Scan the QR code in Google Authenticator / Authy.' %}
  {% set s_step2 = '2. If scanning fails, use this secret:' %}
  {% set s_enter_code = 'Enter code from app' %}
  {% set s_enable_2fa = 'Enable 2FA' %}
  {% set s_start_2fa = 'Set up 2FA now' %}
  {% set s_devices = 'Login devices' %}
  {% set s_no_devices = 'No active login devices.' %}
  {% set s_end_session = 'End session' %}
  {% set s_api = 'API keys' %}
  {% set s_api_sub = 'Use header X-API-Key: YOUR_KEY for external software.' %}
  {% set s_api_base = 'API base:' %}
  {% set s_api_once = 'New API key created. It is shown in full only once.' %}
  {% set s_api_save = 'Store this key now in your password manager.' %}
  {% set s_copy = 'Copy' %}
  {% set s_copied = 'Key copied.' %}
  {% set s_copy_fail = 'Copy failed. Please copy manually.' %}
  {% set s_api_name = 'Key name' %}
  {% set s_api_create = 'Create new API key' %}
  {% set s_created = 'Created' %}
  {% set s_last_used = 'Last used' %}
  {% set s_actions = 'Actions' %}
  {% set s_rename = 'Save' %}
  {% set s_delete = 'Delete' %}
  {% set s_no_keys = 'No API keys created yet.' %}
  {% set s_danger = 'Delete account' %}
  {% set s_danger_sub = 'Warning: your account will be permanently deleted. This cannot be undone.' %}
  {% set s_danger_btn = 'âŒ Delete account permanently' %}
  {% set s_confirm = 'Are you sure? This action cannot be undone.' %}
{% elif lang == 'ar' %}
  {% set s_title = 'ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù† â€“ Ouhud QR' %}
  {% set s_h1 = 'ğŸ”’ Ø§Ù„Ø£Ù…Ø§Ù†' %}
  {% set s_sub = 'Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ùˆ2FA ÙˆØ£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆÙ…ÙØ§ØªÙŠØ­ API ÙˆØ­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨.' %}
  {% set s_pw = 'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' %}
  {% set s_old = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©' %}
  {% set s_new = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' %}
  {% set s_new2 = 'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' %}
  {% set s_save = 'ğŸ’¾ Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' %}
  {% set s_2fa = 'Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (2FA)' %}
  {% set s_2fa_sub = 'Ø£Ø¶Ù Ø·Ø¨Ù‚Ø© Ø£Ù…Ø§Ù† Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ø¨Ø± ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©.' %}
  {% set s_status = 'Ø§Ù„Ø­Ø§Ù„Ø©:' %}
  {% set s_active = 'Ù†Ø´Ø·' %}
  {% set s_inactive = 'ØºÙŠØ± Ù†Ø´Ø·' %}
  {% set s_pwd_confirm = 'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' %}
  {% set s_code = 'Ø±Ù…Ø² 2FA Ø§Ù„Ø­Ø§Ù„ÙŠ' %}
  {% set s_disable_2fa = 'ØªØ¹Ø·ÙŠÙ„ 2FA' %}
  {% set s_step1 = '1. Ø§Ù…Ø³Ø­ Ø±Ù…Ø² QR Ø¹Ø¨Ø± Google Authenticator / Authy.' %}
  {% set s_step2 = '2. Ø¥Ø°Ø§ ØªØ¹Ø°Ø± Ø§Ù„Ù…Ø³Ø­ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø³Ø±:' %}
  {% set s_enter_code = 'Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ·Ø¨ÙŠÙ‚' %}
  {% set s_enable_2fa = 'ØªÙØ¹ÙŠÙ„ 2FA' %}
  {% set s_start_2fa = 'Ø¥Ø¹Ø¯Ø§Ø¯ 2FA Ø§Ù„Ø¢Ù†' %}
  {% set s_devices = 'Ø£Ø¬Ù‡Ø²Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„' %}
  {% set s_no_devices = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù†Ø´Ø·Ø©.' %}
  {% set s_end_session = 'Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©' %}
  {% set s_api = 'Ù…ÙØ§ØªÙŠØ­ API' %}
  {% set s_api_sub = 'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© X-API-Key: YOUR_KEY Ù„Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©.' %}
  {% set s_api_base = 'Ù…Ø³Ø§Ø± API:' %}
  {% set s_api_once = 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ API Ø¬Ø¯ÙŠØ¯. Ø³ÙŠØ¸Ù‡Ø± ÙƒØ§Ù…Ù„Ù‹Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.' %}
  {% set s_api_save = 'Ø§Ø­ÙØ¸ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¢Ù† ÙÙŠ Ù…Ø¯ÙŠØ± ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±.' %}
  {% set s_copy = 'Ù†Ø³Ø®' %}
  {% set s_copied = 'ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­.' %}
  {% set s_copy_fail = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§.' %}
  {% set s_api_name = 'Ø§Ø³Ù… Ø§Ù„Ù…ÙØªØ§Ø­' %}
  {% set s_api_create = 'Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙØªØ§Ø­ API Ø¬Ø¯ÙŠØ¯' %}
  {% set s_created = 'ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡' %}
  {% set s_last_used = 'Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…' %}
  {% set s_actions = 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª' %}
  {% set s_rename = 'Ø­ÙØ¸' %}
  {% set s_delete = 'Ø­Ø°Ù' %}
  {% set s_no_keys = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙØ§ØªÙŠØ­ API Ø¨Ø¹Ø¯.' %}
  {% set s_danger = 'Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨' %}
  {% set s_danger_sub = 'ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.' %}
  {% set s_danger_btn = 'âŒ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§' %}
  {% set s_confirm = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.' %}
{% else %}
  {% set s_title = 'ğŸ”’ Sicherheit â€“ Ouhud QR' %}
  {% set s_h1 = 'ğŸ”’ Sicherheit' %}
  {% set s_sub = 'Verwalte Passwort, 2FA, Login-GerÃ¤te, API-SchlÃ¼ssel und Konto-LÃ¶schung.' %}
  {% set s_pw = 'Passwort Ã¤ndern' %}
  {% set s_old = 'Aktuelles Passwort' %}
  {% set s_new = 'Neues Passwort' %}
  {% set s_new2 = 'Neues Passwort bestÃ¤tigen' %}
  {% set s_save = 'ğŸ’¾ Passwort speichern' %}
  {% set s_2fa = 'Zwei-Faktor-Authentifizierung (2FA)' %}
  {% set s_2fa_sub = 'Aktiviere eine zusÃ¤tzliche Sicherheitsstufe per Authenticator-App.' %}
  {% set s_status = 'Status:' %}
  {% set s_active = 'Aktiv' %}
  {% set s_inactive = 'Nicht aktiv' %}
  {% set s_pwd_confirm = 'Passwort zur BestÃ¤tigung' %}
  {% set s_code = 'Aktueller 2FA-Code' %}
  {% set s_disable_2fa = '2FA deaktivieren' %}
  {% set s_step1 = '1. QR-Code in Google Authenticator / Authy scannen.' %}
  {% set s_step2 = '2. Falls Scan nicht geht, diesen Secret verwenden:' %}
  {% set s_enter_code = 'Code aus App eingeben' %}
  {% set s_enable_2fa = '2FA aktivieren' %}
  {% set s_start_2fa = '2FA jetzt einrichten' %}
  {% set s_devices = 'Login-GerÃ¤te' %}
  {% set s_no_devices = 'Keine aktiven GerÃ¤te angemeldet.' %}
  {% set s_end_session = 'Sitzung beenden' %}
  {% set s_api = 'API-SchlÃ¼ssel' %}
  {% set s_api_sub = 'Nutze Header X-API-Key: DEIN_KEY fÃ¼r externe Software.' %}
  {% set s_api_base = 'API Basis:' %}
  {% set s_api_once = 'Neuer API-SchlÃ¼ssel erstellt. Er wird nur jetzt vollstÃ¤ndig angezeigt.' %}
  {% set s_api_save = 'Speichere den SchlÃ¼ssel jetzt sicher in deinem Passwort-Manager.' %}
  {% set s_copy = 'Kopieren' %}
  {% set s_copied = 'SchlÃ¼ssel kopiert.' %}
  {% set s_copy_fail = 'Kopieren fehlgeschlagen. Bitte manuell markieren und kopieren.' %}
  {% set s_api_name = 'Name des SchlÃ¼ssels' %}
  {% set s_api_create = 'Neuen API-SchlÃ¼ssel erstellen' %}
  {% set s_created = 'Erstellt' %}
  {% set s_last_used = 'Zuletzt genutzt' %}
  {% set s_actions = 'Aktionen' %}
  {% set s_rename = 'Speichern' %}
  {% set s_delete = 'LÃ¶schen' %}
  {% set s_no_keys = 'Noch keine API-SchlÃ¼ssel erstellt.' %}
  {% set s_danger = 'Konto lÃ¶schen' %}
  {% set s_danger_sub = 'Achtung: Dein Konto wird dauerhaft entfernt. Dieser Vorgang kann nicht rÃ¼ckgÃ¤ngig gemacht werden.' %}
  {% set s_danger_btn = 'âŒ Konto endgÃ¼ltig lÃ¶schen' %}
  {% set s_confirm = 'Bist du sicher? Dieser Vorgang kann nicht rÃ¼ckgÃ¤ngig gemacht werden.' %}
{% endif %}
{% block title %}{{ s_title }}{% endblock %}

{% block content %}
<section class="qr-generator pdf-generator">
  <h1>{{ s_h1 }}</h1>
  <p class="subtitle">{{ s_sub }}</p>

  <div class="qr-form">
    <h2 class="form-title">{{ s_pw }}</h2>
    {% if request.query_params.get("msg") == "updated" %}<div class="alert success">âœ…</div>{% endif %}
    {% if request.query_params.get("error") %}<div class="alert error">âš ï¸ {{ request.query_params.get("error") }}</div>{% endif %}
    <form method="post" action="/settings/security/change-password" class="space-y">
      <div class="form-group"><label>{{ s_old }}</label><input type="password" name="old_password" required></div>
      <div class="form-group"><label>{{ s_new }}</label><input type="password" name="new_password" required></div>
      <div class="form-group"><label>{{ s_new2 }}</label><input type="password" name="confirm_password" required></div>
      <button type="submit" class="btn-primary w-full">{{ s_save }}</button>
    </form>
  </div>

  <hr class="divider">

  <div class="qr-form">
    <h2 class="form-title">{{ s_2fa }}</h2>
    <p class="info-text">{{ s_2fa_sub }}</p>

    {% if twofa_enabled %}
      <div class="info-text"><strong>{{ s_status }}</strong> {{ s_active }}</div>
      <form method="post" action="/settings/security/2fa/disable" class="space-y">
        <div class="form-group"><label>{{ s_pwd_confirm }}</label><input type="password" name="password" required></div>
        <div class="form-group"><label>{{ s_code }}</label><input type="text" name="otp_code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required></div>
        <button class="btn-danger w-full" type="submit">{{ s_disable_2fa }}</button>
      </form>
    {% else %}
      {% if twofa_qr %}
        <div class="twofa-setup">
          <p class="info-text">{{ s_step1 }}</p>
          <img src="{{ twofa_qr }}" alt="2FA Setup QR" class="twofa-qr">
          <p class="info-text">{{ s_step2 }}</p>
          <div class="api-box">{{ twofa_secret }}</div>
          <form method="post" action="/settings/security/2fa/confirm" class="space-y" style="margin-top:1rem;">
            <div class="form-group"><label>{{ s_enter_code }}</label><input type="text" name="otp_code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" required></div>
            <button class="btn-primary w-full" type="submit">{{ s_enable_2fa }}</button>
          </form>
        </div>
      {% else %}
        <div class="info-text"><strong>{{ s_status }}</strong> {{ s_inactive }}</div>
        <form method="post" action="/settings/security/2fa/start"><button class="btn-primary w-full" type="submit">{{ s_start_2fa }}</button></form>
      {% endif %}
    {% endif %}
  </div>

  <hr class="divider">

  <div class="qr-form">
    <h2 class="form-title">{{ s_devices }}</h2>
    {% if devices and devices|length > 0 %}
      <ul class="device-list">
        {% for d in devices %}
        <li class="device-entry">
          <div><strong>{{ d.device }}</strong><br><span class="device-meta">IP: {{ d.ip }} â€¢ {{ d.last_login }}</span></div>
          <a href="/settings/security/device/remove/{{ d.id }}" class="btn-danger-sm">{{ s_end_session }}</a>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="info-text">{{ s_no_devices }}</p>
    {% endif %}
  </div>

  <hr class="divider">

  <div class="qr-form">
    <h2 class="form-title">{{ s_api }}</h2>
    <p class="info-text">{{ s_api_sub }}</p>
    <p class="info-text">{{ s_api_base }} <code>/api/v1</code></p>

    {% if newly_created_api_key %}
      <div class="alert success">{{ s_api_once }}</div>
      <div class="api-key-once">
        <input id="new-api-key" type="text" value="{{ newly_created_api_key }}" readonly>
        <button id="copy-key-btn" type="button" class="btn-primary" onclick="copyApiKey()">{{ s_copy }}</button>
      </div>
      <p id="copy-key-status" class="info-text" style="margin-top:.35rem;"></p>
      <div class="alert error">{{ s_api_save }}</div>
    {% endif %}

    <form method="post" action="/settings/security/api-keys/create" class="space-y" style="margin-bottom:1rem;">
      <div class="form-group"><label>{{ s_api_name }}</label><input type="text" name="name" placeholder="CRM Integration" required></div>
      <button class="btn-primary" type="submit">{{ s_api_create }}</button>
    </form>

    {% if api_keys and api_keys|length > 0 %}
      <div style="overflow:auto;">
        <table class="api-table">
          <thead>
            <tr><th>Name</th><th>Key</th><th>{{ s_created }}</th><th>{{ s_last_used }}</th><th>{{ s_actions }}</th></tr>
          </thead>
          <tbody>
            {% for k in api_keys %}
              <tr>
                <td>
                  <form method="post" action="/settings/security/api-keys/{{ k.id }}/rename" style="display:flex;gap:.4rem;align-items:center;">
                    <input type="text" name="name" value="{{ k.name }}" style="min-width:160px;">
                    <button class="btn-primary" type="submit">{{ s_rename }}</button>
                  </form>
                </td>
                <td><code>{{ k.prefix }}...{{ k.last4 }}</code></td>
                <td>{{ k.created_at.strftime("%d.%m.%Y %H:%M") if k.created_at else "-" }}</td>
                <td>{{ k.last_used_at.strftime("%d.%m.%Y %H:%M") if k.last_used_at else "-" }}</td>
                <td>
                  <form method="post" action="/settings/security/api-keys/{{ k.id }}/delete" onsubmit="return confirm('{{ s_confirm }}');">
                    <button class="btn-danger" type="submit">{{ s_delete }}</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="info-text">{{ s_no_keys }}</p>
    {% endif %}
  </div>

  <hr class="divider">

  <div class="qr-form danger-zone">
    <h2 class="form-title text-red">{{ s_danger }}</h2>
    <p class="info-text text-red">{{ s_danger_sub }}</p>
    <form method="post" action="/settings/security/delete-account" onsubmit="return confirm('{{ s_confirm }}');">
      <button class="btn-danger w-full">{{ s_danger_btn }}</button>
    </form>
  </div>
</section>

<style>
.qr-generator { max-width: 720px; margin: 0 auto; padding: 2rem 1rem; }
.qr-generator h1 { font-size: 2rem; margin-bottom: .5rem; }
.subtitle { margin-bottom: 2rem; color: #64748b; }
.qr-form { background:#fff; padding:1.6rem; border-radius:18px; border:1px solid #e2e8f0; box-shadow:0 3px 8px rgba(0,0,0,0.05); margin-bottom:2rem; }
.form-title { font-size:1.25rem; font-weight:600; margin-bottom:1rem; color:var(--primary); }
.form-group { margin-bottom:1rem; }
.form-group label { font-weight:600; margin-bottom:.3rem; display:block; }
input { width:100%; padding:.6rem .8rem; border:1px solid #cbd5e1; border-radius:8px; }
.btn-primary { background:var(--accent); color:#fff; padding:.7rem 1rem; border-radius:10px; font-weight:600; border:0; cursor:pointer; }
.btn-danger { background:#dc2626; color:#fff; padding:.75rem 1rem; border-radius:10px; border:0; cursor:pointer; }
.api-key-once { display:flex; gap:.6rem; align-items:center; margin-bottom:1rem; flex-wrap:wrap; }
.api-key-once input { flex:1; min-width:320px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background:#f8fafc; }
.api-table { width:100%; border-collapse:collapse; }
.api-table th, .api-table td { padding:.6rem .4rem; border-bottom:1px solid #e2e8f0; text-align:left; }
.btn-danger-sm { color:#dc2626; font-weight:600; text-decoration:none; }
.divider { border:none; border-top:1px solid #e5e7eb; margin:2rem 0; }
.device-entry { background:#f8fafc; padding:.9rem 1rem; border-radius:12px; border:1px solid #e2e8f0; display:flex; justify-content:space-between; }
.api-box { background:#f1f5f9; border:1px solid #d1d5db; padding:.8rem; border-radius:8px; word-break:break-all; }
.twofa-setup { text-align:center; }
.twofa-qr { width:220px; max-width:100%; border:1px solid #e2e8f0; border-radius:12px; background:#fff; padding:.5rem; }
.alert { padding:.7rem; border-radius:10px; font-weight:600; margin-bottom:.7rem; }
.alert.success { background:#ecfdf5; color:#15803d; }
.alert.error { background:#fef2f2; color:#b91c1c; }
</style>

<script>
const COPY_OK = {{ s_copied | tojson }};
const COPY_FAIL = {{ s_copy_fail | tojson }};
const COPY_LABEL = {{ s_copy | tojson }};

function copyApiKey() {
  const input = document.getElementById("new-api-key");
  const status = document.getElementById("copy-key-status");
  const btn = document.getElementById("copy-key-btn");
  if (!input) return;

  const value = input.value || "";
  const markSuccess = () => {
    if (status) status.textContent = COPY_OK;
    if (btn) btn.textContent = COPY_OK;
    setTimeout(() => {
      if (btn) btn.textContent = COPY_LABEL;
    }, 1500);
  };
  const markError = () => {
    if (status) status.textContent = COPY_FAIL;
  };

  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(value).then(markSuccess).catch(() => {
      input.focus();
      input.select();
      try {
        const ok = document.execCommand("copy");
        if (ok) markSuccess();
        else markError();
      } catch (_) {
        markError();
      }
    });
    return;
  }

  input.focus();
  input.select();
  try {
    const ok = document.execCommand("copy");
    if (ok) markSuccess();
    else markError();
  } catch (_) {
    markError();
  }
}
</script>
{% endblock %}
