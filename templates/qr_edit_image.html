{% extends "base.html" %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% if lang == 'en' %}
  {% set p_title = 'ğŸ¨ Edit QR design â€“ Ouhud QR' %}
  {% set h1 = 'ğŸ¨ Edit QR code design' %}
  {% set sub = 'Adjust logo, colors, and style of your QR code.' %}
  {% set ok = 'âœ… Changes saved successfully!' %}
  {% set logo = 'ğŸ·ï¸ Upload logo (optional):' %}
  {% set current = 'Current logo:' %}
  {% set fg = 'ğŸ¨ Foreground color:' %}
  {% set bg = 'ğŸ–Œï¸ Background color:' %}
  {% set save = 'ğŸ’¾ Save changes' %}
  {% set back = 'â¬…ï¸ Back to QR editor' %}
{% elif lang == 'ar' %}
  {% set p_title = 'ğŸ¨ ØªØ¹Ø¯ÙŠÙ„ ØªØµÙ…ÙŠÙ… QR â€“ Ouhud QR' %}
  {% set h1 = 'ğŸ¨ ØªØ¹Ø¯ÙŠÙ„ ØªØµÙ…ÙŠÙ… Ø±Ù…Ø² QR' %}
  {% set sub = 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆÙ†Ù…Ø· Ø±Ù…Ø² QR.' %}
  {% set ok = 'âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!' %}
  {% set logo = 'ğŸ·ï¸ Ø±ÙØ¹ Ø´Ø¹Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):' %}
  {% set current = 'Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:' %}
  {% set fg = 'ğŸ¨ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ:' %}
  {% set bg = 'ğŸ–Œï¸ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©:' %}
  {% set save = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª' %}
  {% set back = 'â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„ QR' %}
{% else %}
  {% set p_title = 'ğŸ¨ QR-Design bearbeiten â€“ Ouhud QR' %}
  {% set h1 = 'ğŸ¨ QR-Code Design bearbeiten' %}
  {% set sub = 'Hier kannst du dein Logo, Farben oder Stil deines QR-Codes anpassen.' %}
  {% set ok = 'âœ… Ã„nderungen erfolgreich gespeichert!' %}
  {% set logo = 'ğŸ·ï¸ Logo hochladen (optional):' %}
  {% set current = 'Aktuelles Logo:' %}
  {% set fg = 'ğŸ¨ Vordergrundfarbe:' %}
  {% set bg = 'ğŸ–Œï¸ Hintergrundfarbe:' %}
  {% set save = 'ğŸ’¾ Ã„nderungen speichern' %}
  {% set back = 'â¬…ï¸ ZurÃ¼ck zur QR-Bearbeitung' %}
{% endif %}
{% block title %}{{ p_title }}{% endblock %}

{% block content %}
<section class="qr-design">
  <h1>{{ h1 }}</h1>
  <p class="subtitle">{{ sub }}</p>

  {% if request.query_params.get("msg") == "ok" %}
  <div class="alert success">{{ ok }}</div>
  {% endif %}

  <form method="post" action="/qr/image/{{ qr.slug }}/update-image" enctype="multipart/form-data">
    <div class="form-grid">
      <div>
        <label for="logo">{{ logo }}</label>
        <input type="file" id="logo" name="logo" accept="image/*" onchange="previewLogo(event)">

        <div id="logoPreviewContainer" {% if not data.logo %}style="display:none;"{% endif %}>
          <p>{{ current }}</p>
          {% if data.logo %}
            <img id="logoPreview" src="{{ data.logo }}" alt="Logo-Vorschau" class="preview">
          {% endif %}
        </div>
      </div>

      <div>
        <label for="fg_color">{{ fg }}</label>
        <input type="color" id="fg_color" name="fg_color" value="{{ data.fg_color or '#000000' }}">
      </div>

      <div>
        <label for="bg_color">{{ bg }}</label>
        <input type="color" id="bg_color" name="bg_color" value="{{ data.bg_color or '#ffffff' }}">
      </div>
    </div>

    <button type="submit" class="btn full">{{ save }}</button>
    <a href="/qr/edit/{{ qr.slug }}" class="btn secondary">{{ back }}</a>
  </form>
</section>

<style>
.qr-design { max-width: 800px; margin: 3rem auto; padding: 2.5rem; background: #fff; border-radius: 20px; box-shadow: 0 8px 30px rgba(13, 42, 120, 0.08); font-family: "Inter", system-ui, sans-serif; }
h1 { text-align:center; color:#0d2a78; margin-bottom:.5rem; }
.subtitle { text-align:center; color:#475569; margin-bottom:2rem; }
.form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; }
label { display:block; font-weight:600; color:#0d2a78; margin-bottom:.5rem; }
input[type="color"], input[type="file"] { width:100%; padding:.5rem; border:1px solid #cbd5e1; border-radius:10px; background:#f9fafb; }
.btn { display:inline-block; background:linear-gradient(135deg,#0d2a78,#2563eb); color:white; border:none; border-radius:10px; padding:.8rem 1.6rem; font-weight:600; text-decoration:none; cursor:pointer; margin-top:1.5rem; transition:all .2s ease-in-out; }
.btn.full { display:block; width:100%; text-align:center; }
.btn.secondary { background:#2563eb; text-align:center; display:block; margin-top:1rem; }
.alert.success { background:#dcfce7; color:#166534; padding:.8rem 1rem; border-radius:10px; margin-bottom:1rem; text-align:center; font-weight:500; }
.preview { max-width:120px; margin-top:.5rem; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
</style>

<script>
function previewLogo(event) {
  const container = document.getElementById('logoPreviewContainer');
  const img = document.getElementById('logoPreview') || document.createElement('img');
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      img.src = e.target.result;
      img.classList.add('preview');
      container.style.display = 'block';
      if (!container.contains(img)) container.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
}
</script>
{% endblock %}
